
- @page_title= _ :title

%div
 %h2{:align => 'center'}= @conf_data['info']['title'][@data_lang_code]
 %h2{:align => 'center'}= _(:title)
 -#%div{:aalign => 'center'}
 %table{border: 1, style: "border-collapse: collapse"}
  %tr
   %th{rowspan: 3, valign: 'top', align: 'center'} N
   %th= _ :ptitle
   %th= _ :registrator
  %tr
   %th{colspan: 2}= _ :pauthors
  %tr
   %th{colspan: 2}
    %table{border: 1, width: '100%', style: "border-collapse: collapse"}
     %tr
      %th{rowspan: 3}= _ :reviewer
      %th= _ :score
      %th= _ :decision
     %tr
      %th{colspan: 2, style: "border-bottom: solid 3px black"}= _ :ipccomments
     %tr
      %th{colspan: 2}= _ :authcomments
  -@report_data['papers'].each do |r|
   %tr
    %td{rowspan: 3, valign: 'top', align: 'center'}= r['paper_cnt']
    %td= r['title']
    %td= (r['registrator_data']['user_name'] + ' (' + r['registrator_data']['pin'].to_s  + ')')
   %tr
    %td{colspan: 2}
     - r['authors_data'].each do |a|
      =%w[user_name affiliation city].map{|n| a[n]}.join(', ') +', '+ (call '/comp/user/country_name', :locals => {:code => a['country'].dup}).strip
      -#=a.inspect
      %br
   %tr
    -#%td{colspan: 2}= r.inspect
    -#%td{colspan: 2}= r['reviews_data'].inspect
    %td{colspan: 2}
     %table{border: 1, width: '100%', style: "border-collapse: collapse"}
      -r['reviews_data'].each do |r|
       %tr
        -#%td=r.inspect
        -#%td=r['reviewer'].inspect
        -#%td=%w[fname mname lname].map{ |n| r['reviewer'][n][@data_lang_code]}.join(' ') + ' (' + r['reviewer']['userpin'].to_s + ')'
        %td{rowspan: 3}=r['reviewer']['user_name']
        %td= _ ('score_'+r['data']['score'])
        %td= _ ('decision_'+r['data']['decision'])
       %tr
        -#%td{colspan: 2, style: "border-bottom: solid 3px black;"}=r['data']['ipccomments'].to_s
        %td{colspan: 2, style: "border-bottom: solid 3px black"}
         -@lang_list.select{ |l| r['data']['ipccomments'] && r['data']['ipccomments'][l] && r['data']['ipccomments'][l].length>0 }.each do |l|
          = l+': '
          = r['data']['ipccomments'][l]
          %br
       %tr
        -#%td{colspan: 2}=r['data']['authcomments'].to_s
        %td{colspan: 2}
         -@lang_list.select{ |l| r['data']['authcomments'] && r['data']['authcomments'][l] && r['data']['authcomments'][l].length>0 }.each do |l|
          = l+': '
          = r['data']['authcomments'][l]
          %br

  -# sec_hash = @conf_sections.inject({}) { |a, s| a[s['id']] = s; a }
  -# sec_ordered = @conf_sections.map {|sec| {'id' =>sec['id'], 'name' => sec['name'][@data_lang_code]} }.sort {|a,b| a['name']<=>b['name']}
  -# sec_ordered << {'id' => nil, 'name' => '***'}
  -# sec_ordered.each do |sec|
   %h3{:align => 'center'}&= sec['name']
   - sec_data = @report_data[sec['id']]
   - if sec_data
    - sec_data.each do |r|
     %div{style: 'margin-bottom: 10pt;'}
      %b= _(:paper_cnt)+': '
      %span&= r['_meta']['paper_cnt']
      %br
      %b= _(:paper_owner)+': '
      %span&= r['_meta']['owner'].to_s + ' | ' + %w[fname mname lname].map{ |f| r['owner_info'][f][@data_lang_code] }.join(' ')
      %br
      %b><= _(:paper_authors)+': '
      - authors = r['authors'].map{ |a|
      -    %w[fname mname lname].map{ |f|
      -            a[f][@data_lang_code]
      -    }.join(' ') + ' ('+ [ a['affiliation'][@data_lang_code], a['city'][@data_lang_code], (call '/comp/user/country_name', :locals => {:code => a['country']}) ].join(', ') + ')'
      - }.join('; ')
      %span&= authors
      %br
      %b= _(:paper_title)+': '
      %span&= r['text']['title'][@data_lang_code]
      %br
      %b= _(:paper_abstract)+': '
      %span&= r['text']['abstract'][@data_lang_code]
      %br
      %b= _(:paper_keywords)+': '
      - keywords = r['keywords'].map{ |kw|
      -    kw[@data_lang_code]
      - }.join(', ')
      %span&= keywords
      %br
      %b= _(:paper_abstract_file)+': '
      - r['files'].select{ |f| f[:_meta]['lang']==@data_lang_code }.map do |f|
       %a{href: '../download/abstract/'+f[:uniquefilename]+'?id='+f[:_meta]['parent']+'&lang='+f[:_meta]['lang']}= _ :paper_abstract_file_download
       = ' (' + f[:length].to_s + ' ' + _(:bytes) + ', ' + f[:_meta]['ctime'].to_s + ')'
      %br
      %b= _(:paper_decision_section)+': '
      %span&= -> { section = @conf_sections.select {|s| s['id']==r['decision']['section'] }.first; section && section['name'] ? section['name'][@data_lang_code] : '' }[]


-@_tj_next_template = ''


